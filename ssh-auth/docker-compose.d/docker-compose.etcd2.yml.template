---
## reference compose file: https://gist.github.com/setekhid/17a7bfb8ac26428ebced829d28f780aa
version: "2"

services:
  etcd2:
    image: quay.io/coreos/etcd:v3.1.7
    restart: always
    networks:
      etcd_net:
        ipv4_address: {{ etcd2 }}
    ports:
      - 2379:2379
      - 4001:4001
    environment:
      ETCD_NAME: infra2
      ETCD_INITIAL_CLUSTER: infra1=http://{{ etcd1 }}:4001,infra2=http://{{ etcd2 }}:4001,infra3=http://{{ etcd3 }}:4001
      ETCD_INITIAL_CLUSTER_STATE: new
      ETCD_INITIAL_CLUSTER_TOKEN: etcd-tasting-01
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379,http://0.0.0.0:2379
      ETCD_LISTEN_PEER_URLS: http://0.0.0.0:4001
      ETCD_ADVERTISE_CLIENT_URLS: http://{{ etcd2 }}:2379,http://{{ etcd2 }}:4001
      ETCD_INITIAL_ADVERTISE_PEER_URLS: http://{{ etcd2 }}:4001
networks:
  etcd_net:
    ipam:
      driver: default
      config:
        - subnet: 172.19.0.0/16
...
