---
## reference compose file: https://gist.github.com/setekhid/17a7bfb8ac26428ebced829d28f780aa
version: "2"

services:
  etcd1:
    container_name: etcd1
    image: quay.io/coreos/etcd
    restart: always
    networks:
      etcd_net:
        ipv4_address: 172.19.1.10
    environment:
      ETCD_NAME: infra1
      ETCD_INITIAL_CLUSTER: infra1=http://172.19.1.10:4001,infra2=http://172.19.1.11:4001,infra3=http://172.19.1.12:4001
      ETCD_INITIAL_CLUSTER_STATE: new
      ETCD_INITIAL_CLUSTER_TOKEN: etcd-tasting-01
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379
      ETCD_LISTEN_PEER_URLS: http://0.0.0.0:4001
      ETCD_ADVERTISE_CLIENT_URLS: http://172.19.1.10:2379,http://172.19.1.10:4001
      ETCD_INITIAL_ADVERTISE_PEER_URLS: http://172.19.1.10:4001
  etcd2:
    container_name: etcd2
    image: quay.io/coreos/etcd
    restart: always
    networks:
      etcd_net:
        ipv4_address: 172.19.1.11
    environment:
      ETCD_NAME: infra2
      ETCD_INITIAL_CLUSTER: infra1=http://172.19.1.10:4001,infra2=http://172.19.1.11:4001,infra3=http://172.19.1.12:4001
      ETCD_INITIAL_CLUSTER_STATE: new
      ETCD_INITIAL_CLUSTER_TOKEN: etcd-tasting-01
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379
      ETCD_LISTEN_PEER_URLS: http://0.0.0.0:4001
      ETCD_ADVERTISE_CLIENT_URLS: http://172.19.1.11:2379,http://172.19.1.11:4001
      ETCD_INITIAL_ADVERTISE_PEER_URLS: http://172.19.1.11:4001
  etcd3:
    container_name: etcd3
    image: quay.io/coreos/etcd
    restart: always
    networks:
      etcd_net:
        ipv4_address: 172.19.1.12
    environment:
      ETCD_NAME: infra3
      ETCD_INITIAL_CLUSTER: infra1=http://172.19.1.10:4001,infra2=http://172.19.1.11:4001,infra3=http://172.19.1.12:4001
      ETCD_INITIAL_CLUSTER_STATE: new
      ETCD_INITIAL_CLUSTER_TOKEN: etcd-tasting-01
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379
      ETCD_LISTEN_PEER_URLS: http://0.0.0.0:4001
      ETCD_ADVERTISE_CLIENT_URLS: http://172.19.1.12:2379,http://172.19.1.12:4001
      ETCD_INITIAL_ADVERTISE_PEER_URLS: http://172.19.1.12:4001
networks:
  etcd_net:
    ipam:
      driver: default
      config:
        - subnet: 172.19.0.0/16
...
